
---
title: 'Survival Analysis Report: Veteran Lung Cancer Dataset'
author: "Elyvine Oloo Otieno | QuantWise Hub"
date: "`r Sys.Date()`"
output:
  word_document: default
  toc_depth: 2
  number_sections: true
  theme: readable
  highlight: tango
  toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(survival)
library(dplyr)
library(ggplot2)
library(survminer)
library(rms)
```

### 1. Introduction

This report presents a survival analysis of the `veteran` data set, which includes data from a clinical trial of chemotherapy for lung cancer. The analysis focuses on exploring survival patterns, building predictive models, and validating those models for clinical use.

### 2. Data Loading and Preparation

```{r load-data}
data(veteran)
df <- veteran
head(df)
```

### Variable Descriptions

- `time`: Survival time (days)
- `status`: 1 = died, 0 = censored
- `trt`: 1 = standard, 2 = test drug
- `celltype`: Tumor cell type
- `karno`: Karnofsky performance score
- `diagtime`: Time from diagnosis to study entry
- `age`: Age in years
- `prior`: Prior therapy (0 = no, 10 = yes)

```{r clean-data}
df$status <- ifelse(df$status == 1, 1, 0)
df$trt <- factor(df$trt, levels = c(1, 2), labels = c("Standard", "Test Drug"))
df$prior <- factor(df$prior, levels = c(0, 10), labels = c("No", "Yes"))
df$celltype <- factor(df$celltype)
```

### 3. Exploratory Data Analysis

```{r eda-plots}
# Age distribution
ggplot(df, aes(x = age)) + 
  geom_histogram(fill = "steelblue", bins = 15) +
  theme_minimal() + 
  labs(title = "Age Distribution")

# Treatment groups
ggplot(df, aes(x = trt)) + 
  geom_bar(fill = "darkorange") +
  theme_minimal() +
  labs(title = "Treatment Distribution")
```

### 4. Survival Analysis

```{r surv-objects}
surv_obj <- Surv(time = df$time, event = df$status)
```

### 4.1 Kaplan-Meier Survival Curve (Overall)

```{r km-overall}
km_fit <- survfit(surv_obj ~ 1, data = df)
ggsurvplot(km_fit, data = df, conf.int = TRUE, risk.table = TRUE, 
           title = "Overall Survival Curve")
```

### 4.2 Survival by Treatment Group

```{r km-treatment}
km_trt <- survfit(surv_obj ~ trt, data = df)
ggsurvplot(km_trt, data = df, pval = TRUE, conf.int = TRUE, risk.table = TRUE,
           legend.title = "Treatment",
           title = "Survival by Treatment Group")
```

### 5. Cox Proportional Hazards Model

```{r cox-model}
cox_model <- coxph(surv_obj ~ age + trt + karno + celltype, data = df)
summary(cox_model)
```

### 6. Predictive Modeling and Validation

```{r rms-setup}
dd <- datadist(df)
options(datadist = "dd")

cox_rms <- cph(Surv(time, status) ~ age + trt + karno + celltype, data = df,
               x = TRUE, y = TRUE, surv = TRUE)
```



### 6.1 Calibration Plot (180 Days)

```{r calibration-plot}
cal <- calibrate(cox_rms, method = "boot", B = 200, u = 180)
plot(cal, xlab = "Predicted 180-Day Survival", ylab = "Observed Survival",
     main = "Calibration Plot at 180 Days")
```

### 6.2 Internal Validation (Bootstrap)

```{r internal-validation}
validate(cox_rms, method = "boot", B = 200)
```

### 7. Clinical Interpretation

The calibration curve at 180 days indicates strong agreement between predicted and actual survival probabilities. Bootstrap validation confirms the modelâ€™s stability with minimal over fitting. This model is clinically valuable for patient risk stratification and treatment evaluation.

### 8. Conclusion

This analysis provides insight into factors affecting survival in lung cancer patients, including age, performance status, and treatment type. The validated model offers a foundation for predictive analytics in clinical decision support.
